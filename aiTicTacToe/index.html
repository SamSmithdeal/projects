
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        #board{
    width: 500px;
    height: 500px;
    border: 1px solid black;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
}
.spot{
    border: 1px solid black;
    font-family: Arial, Helvetica, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 200%;
}
    </style>
</head>
<body>
    <div id="board">
        <div id="00" class="spot"></div>
        <div id="01" class="spot"></div>
        <div id="02" class="spot"></div>

        <div id="10" class="spot"></div>
        <div id="11" class="spot"></div>
        <div id="12" class="spot"></div>

        <div id="20" class="spot"></div>
        <div id="21" class="spot"></div>
        <div id="22" class="spot"></div>

    </div>


    <script>
        var gameState = [
    ["","",""],
    ["","",""],
    ["","",""]
];
var gameFinished = false;
var playerTurn = true;
var aiTurn = false;

var numOfWhites = [];
var numOfBlacks = [];


var board = document.getElementById("board");
board.addEventListener('click', playerPlay);


function playerPlay(ev){
    if(playerTurn){
        if(ev.target.textContent == ""){
            ev.target.textContent = "X";
            var x = ev.target.id[0];
            var y = ev.target.id[1]
            gameState[x][y] = "X";

            ////////remove for normal tictactoe
            if(numOfWhites.length >=3){
                gameState[numOfWhites[0].x][numOfWhites[0].y]="";
                document.getElementById(""+numOfWhites[0].x+numOfWhites[0].y).textContent="";
                numOfWhites.splice(0,1);
            }
            numOfWhites.push({x,y});

            /////////////////////////////////////////////
        }
        if(checkPlayerWin("X")){
            setTimeout(()=>{
                alert("player win")
                return;
            },1000);
        }else if(catsgame()){
            setTimeout(()=>{
                alert("catsgame")
            return;
            },1000);
            
        }
        else{
            setTimeout(()=>{
                aiPlay();
            },1000);
        }
    }
}

function aiPlay(){
    console.log("hi")
    var bestScore = -1000;
    var bestMove;
        for(var x = 0;x<3;x++){
            for(var i=0;i<3;i++){
                if(gameState[x][i] ==""){
                    gameState[x][i] = "O";
                    let score = minmax(gameState, false);
                    gameState[x][i] = "";
                    if(score>bestScore){
                        bestScore=score;
                        bestMove = {x,i};
                    }
                }
            }
        }
        gameState[bestMove.x][bestMove.i] = "O";
        document.getElementById(""+bestMove.x+bestMove.i).textContent = "O";

        //////remove for normal tic tac toe
        numOfBlacks.push(bestMove);

        if(numOfBlacks.length >=4){
            gameState[numOfBlacks[0].x][numOfBlacks[0].i]="";
            document.getElementById(""+numOfBlacks[0].x+numOfBlacks[0].i).textContent="";
            numOfBlacks.splice(0,1);
        }
        /////////////////////////////////////////////////

        if(checkPlayerWin("O")){
            setTimeout(()=>{
                alert("ai wins");
            },1000)
        }
        if(catsgame()){
            setTimeout(()=>{
                alert("catsgame")
            },1000)
        }
}

function minmax(board, aiTurn){
    if(checkPlayerWin("O")){
        return 1;
    }
    else if(checkPlayerWin("X")){
        return -1;
    }
    else if (catsgame()){
        return 0;
    }

    if(aiTurn){
        var bestScore = -1000;
        for(var x = 0;x<3;x++){
            for(var i=0;i<3;i++){
                if(board[x][i] ==""){
                    board[x][i] = "O";
                    let score = minmax(board, false);
                    board[x][i] = "";
                    if(score>bestScore){
                        bestScore=score;
                    }
                }
            }
        }
        return bestScore;
    }
    else{
        var bestScore = 1000;
        for(var x = 0;x<3;x++){
            for(var i=0;i<3;i++){
                if(board[x][i] ==""){
                    board[x][i] = "X";
                    let score = minmax(board, true);
                    board[x][i] = "";
                    if(score<bestScore){
                        bestScore=score;
                    }
                }
            }
        }
        return bestScore;
    }
}

function checkPlayerWin(player){
    for (let i = 0; i < 3; i++) {
        if (
            gameState[i][0] === player && gameState[i][1] === player && gameState[i][2] === player || // Row check
            gameState[0][i] === player && gameState[1][i] === player && gameState[2][i] === player   // Column check
        ) {
            return true;
        }
    }
    if (
        gameState[0][0] === player && gameState[1][1] === player && gameState[2][2] === player || // Main diagonal
        gameState[0][2] === player && gameState[1][1] === player && gameState[2][0] === player   // Anti-diagonal
    ) {
        return true;
    }

    return false;
}

function catsgame(){
    for(var x = 0;x<3;x++){
        for(var i = 0;i<3;i++){
            if(gameState[x][i]==""){
                return false;
            }
        }
    }
    return true;
}


    </script>
</body>
</html>